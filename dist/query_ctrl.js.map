{"version":3,"sources":["../src/query_ctrl.js"],"names":["MODE_SUMMARY","MODE_STATUS","GenericDatasourceQueryCtrl","$scope","$injector","scope","target","type","resultsModes","value","text","mode","init","targetDefaults","_","defaults","getSuggestions","bind","getOptions","query","console","log","datasource","metricFindQuery","then","$digest","a","rawQuery","panelCtrl","refresh","newTarget","cloneDeep","isEqual","oldTarget","QueryCtrl","templateUrl"],"mappings":";;;;;;;;;AAAA;;AACA;;;;;;;;AAEO,IAAMA,sCAAe,CAArB;AACA,IAAMC,oCAAc,CAApB;;IAEMC,0B,WAAAA,0B;;;AAEX,sCAAYC,MAAZ,EAAoBC,SAApB,EAAiC;AAAA;;AAE/B;AACA;;AAH+B,wJACzBD,MADyB,EACjBC,SADiB;;AAK/B,UAAKC,KAAL,GAAaF,MAAb;AACA;AACA,UAAKG,MAAL,CAAYC,IAAZ,GAAmB,MAAKD,MAAL,CAAYC,IAAZ,IAAoB,OAAvC;;AAEA,UAAKC,YAAL,GAAoB,CAClB,EAACC,OAAO,KAAR,EAAqBC,MAAM,SAA3B,EAA0CC,MAAMX,YAAhD,EADkB,EAElB,EAACS,OAAO,QAAR,EAAuBC,MAAM,QAA7B,EAA8CC,MAAMV,WAApD,EAFkB,CAApB;;AAKA;AACA;AACA;AACA;;AAEA,UAAKW,IAAL,GAAY,YAAW;AACrB,UAAIN,SAAS,KAAKA,MAAlB;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAIO,iBAAiB;AACnB,gBAAQb;AADW,OAArB;AAGAc,QAAEC,QAAF,CAAWT,MAAX,EAAmBO,cAAnB;AACD,KAlBD;AAmBA,UAAKD,IAAL;AACA;AACA,UAAKI,cAAL,GAAsBF,EAAEG,IAAF,CAAO,MAAKC,UAAZ,QAAtB;AAxC+B;AAyChC;;;;+BAEUC,K,EAAO;AAAA;;AAChBC,cAAQC,GAAR,CAAY,iBAAZ;AACA,aAAO,KAAKC,UAAL,CAAgBC,eAAhB,CAAgCJ,SAAS,EAAzC,EAA6CK,IAA7C,CAAkD,aAAK;AAC5D,eAAKnB,KAAL,CAAWoB,OAAX;AACAL,gBAAQC,GAAR,CAAYK,CAAZ;AACA,eAAOA,CAAP;AACD,OAJM,CAAP;AAKD;;AAED;AACA;AACA;AACA;AACA;;;;uCAEmB;AACjB,WAAKpB,MAAL,CAAYqB,QAAZ,GAAuB,CAAC,KAAKrB,MAAL,CAAYqB,QAApC;AACD;;;uCAEkB;AACjB,WAAKC,SAAL,CAAeC,OAAf,GADiB,CACS;AAC3B;;;mCAEc;AACb,UAAIC,YAAYhB,EAAEiB,SAAF,CAAY,KAAKzB,MAAjB,CAAhB;AACA,UAAI,CAACQ,EAAEkB,OAAF,CAAU,KAAKC,SAAf,EAA0B,KAAK3B,MAA/B,CAAL,EAA6C;AAC3C,aAAK2B,SAAL,GAAiBH,SAAjB;AACA;AACA,aAAKF,SAAL,CAAeC,OAAf;AACD;AACF;;;sCAEiBlB,I,EAAK;AACrB,WAAKL,MAAL,CAAYK,IAAZ,GAAmBA,IAAnB;AACD;;;;EA/E6CuB,c;;AAiFhDhC,2BAA2BiC,WAA3B,GAAyC,4BAAzC","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport const MODE_SUMMARY = 0;\nexport const MODE_STATUS = 1;\n\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector,)  {\n    super($scope, $injector);\n    // console.log('Query Control constructor')\n    // console.log(this.datasource)\n\n    this.scope = $scope;\n    // this.target.target = this.target.target || 'Select Check';\n    this.target.type = this.target.type || 'table';\n\n    this.resultsModes = [\n      {value: 'sum',       text: 'Summary',     mode: MODE_SUMMARY},\n      {value: 'status',      text: 'Status',        mode: MODE_STATUS},\n    ];\n    \n    // this.$scope.resultsModes = {\n    //   SUMMARY: MODE_SUMMARY,\n    //   STATUS: MODE_STATUS,\n    // };\n    \n    this.init = function() {\n      var target = this.target;\n\n      // Migrate old targets\n      // target = migrations.migrate(target);\n\n      // var scopeDefaults = {\n      //   metric: {},\n      //   oldTarget: _.cloneDeep(this.target),\n      //   queryOptionsText: this.renderQueryOptionsText()\n      // };\n      // _.defaults(this, scopeDefaults);\n\n      // Load default values\n      var targetDefaults = {\n        'mode': MODE_SUMMARY,\n      };\n      _.defaults(target, targetDefaults);\n    };\n    this.init();\n    // this.results = this.datasource.metricFindQuery(query || '');\n    this.getSuggestions = _.bind(this.getOptions, this)\n  }\n\n  getOptions(query) {\n    console.log('Getting options')\n    return this.datasource.metricFindQuery(query || '').then(a => {\n      this.scope.$digest();\n      console.log(a);\n      return a\n    });\n  }\n\n  // getTextValues(metricFindResult) {\n  //   return _.map(metricFindResult, value => {\n  //     return value.text;\n  //   });\n  // }\n\n  toggleEditorMode() {\n    this.target.rawQuery = !this.target.rawQuery;\n  }\n\n  onChangeInternal() {\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\n  }\n\n  onTargetBlur() {\n    var newTarget = _.cloneDeep(this.target);\n    if (!_.isEqual(this.oldTarget, this.target)) {\n      this.oldTarget = newTarget;\n      // this.targetChanged();\n      this.panelCtrl.refresh();\n    }\n  }\n\n  switchResultsMode(mode){\n    this.target.mode = mode;\n  }\n}\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}